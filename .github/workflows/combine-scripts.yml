name: Combine PowerShell Scripts for use with RMM

on:
  push:
    branches:
      - main

jobs:
  combine-scripts:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Combine PowerShell scripts
      shell: pwsh
      run: |
        $sourceDirectory = 'Public'
        $outputFilePath = 'EasyWarrantyCheck_RMM.ps1'
        
        $scriptFiles = Get-ChildItem -Path $sourceDirectory -Filter *.ps1 -Recurse
        
        $combinedContent = ''
        
        foreach ($file in $scriptFiles) {
            $fileContent = Get-Content $file.FullName -Raw
            $combinedContent += $fileContent + "`n`n"
        }
        
        # Add Get-Warranty function call at the end of the script
        $combinedContent += 'Get-Warranty'
        
        $combinedContent | Out-File -FilePath $outputFilePath -Force
        
        Write-Host "Combined script saved to: $outputFilePath"
        
    - name: Push Changes
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions"
        git add .
        git commit -m "Combine PowerShell Functions into 1 script"
        git push